import router from '@ohos.router';
import TokenManager from '../utils/TokenManager';
import promptAction from '@ohos.promptAction';

@Entry
@Component
struct Index {
  @State userToken: string = '';

  aboutToAppear() {
    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
    this.userToken = TokenManager.getToken() || '';
    if (!this.userToken) {
      // å¦‚æžœæ²¡æœ‰tokenï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢
      router.pushUrl({
        url: 'pages/auth/Login'
      });
    }
  }

  // é€€å‡ºç™»å½•
  logout() {
    TokenManager.clear();
    promptAction.showToast({
      message: 'å·²é€€å‡ºç™»å½•',
      duration: 2000
    });
    router.pushUrl({
      url: 'pages/auth/Login'
    });
  }

  build() {
    Column() {
      // æ ‡é¢˜æ 
      Row() {
        Text('è¥å…»ç®¡ç†ç³»ç»Ÿ')
          .fontSize(24)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333333')
        
        Blank()
        
        Button('é€€å‡º')
          .fontSize(14)
          .fontColor('#FF4444')
          .backgroundColor('#FFFFFF')
          .border({
            width: 1,
            color: '#FF4444',
            radius: 6
          })
          .onClick(() => {
            this.logout();
          })
      }
      .width('100%')
      .height(60)
      .padding({ left: 20, right: 20 })
      .backgroundColor('#FFFFFF')
      .shadow({
        radius: 5,
        color: '#00000010',
        offsetY: 2
      })

      // ä¸»è¦å†…å®¹åŒºåŸŸ
      Column() {
        Text('æ¬¢è¿Žä½¿ç”¨è¥å…»ç®¡ç†ç³»ç»Ÿ')
          .fontSize(20)
          .fontWeight(FontWeight.Medium)
          .fontColor('#333333')
          .margin({ top: 40, bottom: 40 })

        // åŠŸèƒ½æ¨¡å—ç½‘æ ¼
        Grid() {
          GridItem() {
            Column() {
              Text('ðŸ“')
                .fontSize(40)
                .margin({ bottom: 10 })
              Text('é¥®é£Ÿè®°å½•')
                .fontSize(16)
                .fontColor('#333333')
            }
            .width('100%')
            .height(120)
            .backgroundColor('#E3F2FD')
            .border({ radius: 12 })
            .justifyContent(FlexAlign.Center)
            .onClick(() => {
              promptAction.showToast({
                message: 'é¥®é£Ÿè®°å½•æ¨¡å—å¼€å‘ä¸­...',
                duration: 2000
              });
            })
          }

          GridItem() {
            Column() {
              Text('ðŸŽ')
                .fontSize(40)
                .margin({ bottom: 10 })
              Text('é£Ÿç‰©è¯†åˆ«')
                .fontSize(16)
                .fontColor('#333333')
            }
            .width('100%')
            .height(120)
            .backgroundColor('#E8F5E8')
            .border({ radius: 12 })
            .justifyContent(FlexAlign.Center)
            .onClick(() => {
              promptAction.showToast({
                message: 'é£Ÿç‰©è¯†åˆ«æ¨¡å—å¼€å‘ä¸­...',
                duration: 2000
              });
            })
          }

          GridItem() {
            Column() {
              Text('ðŸ’¬')
                .fontSize(40)
                .margin({ bottom: 10 })
              Text('è¥å…»è®ºå›')
                .fontSize(16)
                .fontColor('#333333')
            }
            .width('100%')
            .height(120)
            .backgroundColor('#FFF3E0')
            .border({ radius: 12 })
            .justifyContent(FlexAlign.Center)
            .onClick(() => {
              promptAction.showToast({
                message: 'è®ºå›æ¨¡å—å¼€å‘ä¸­...',
                duration: 2000
              });
            })
          }

          GridItem() {
            Column() {
              Text('ðŸ‘¤')
                .fontSize(40)
                .margin({ bottom: 10 })
              Text('ä¸ªäººä¸­å¿ƒ')
                .fontSize(16)
                .fontColor('#333333')
            }
            .width('100%')
            .height(120)
            .backgroundColor('#F3E5F5')
            .border({ radius: 12 })
            .justifyContent(FlexAlign.Center)
            .onClick(() => {
              router.pushUrl({
                url: 'pages/user/Profile'
              });
            })
          }
        }
        .columnsTemplate('1fr 1fr')
        .rowsTemplate('1fr 1fr')
        .width('100%')
        .height(260)
        .columnsGap(20)
        .rowsGap(20)
        .padding(20)

        Text('æ›´å¤šåŠŸèƒ½æ•¬è¯·æœŸå¾…...')
          .fontSize(14)
          .fontColor('#999999')
          .margin({ top: 40 })
      }
      .width('100%')
      .layoutWeight(1)
      .padding(20)
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F5F5F5')
  }
}