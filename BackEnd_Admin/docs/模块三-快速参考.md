# 模块三接口测试 - 快速参考卡

## 📦 文件说明
- `模块三-论坛模块-Postman测试集.json` - Postman 导入文件
- `模块三-Postman测试指南.md` - 详细使用文档（推荐阅读）
- 本文件 - 快速参考

## 🚀 快速开始（3步）

### 1️⃣ 导入到 Postman
```
打开 Postman → Import → 选择 "模块三-论坛模块-Postman测试集.json"
```

### 2️⃣ 配置环境变量
```
点击 Collection → Edit → Variables → 填写以下值：

baseUrl      = http://localhost:8080
userToken    = (通过登录接口获取)
adminToken   = (通过管理员登录获取)
postId       = 1 (发帖后自动保存)
userId       = 1
```

### 3️⃣ 开始测试
```
按顺序执行：
1. 发布帖子 (3.1)
2. 获取列表 (3.2)
3. 获取详情 (3.3)
4. 点赞 (3.4)
5. 评论 (3.5)
6. 状态管理 (3.6)
7. 用户主页 (3.7)
```

---

## 📋 接口清单（12个）

| # | 接口名称 | 方法 | 路径 | 需要Token |
|---|---------|------|------|----------|
| 3.1 | 发布帖子 | POST | `/api/forum/posts` | ✅ User |
| 3.2a | 获取帖子列表-全部 | GET | `/api/forum/posts` | ❌ |
| 3.2b | 获取帖子列表-公开 | GET | `/api/forum/posts?status=0` | ❌ |
| 3.2c | 获取帖子列表-待审核 | GET | `/api/forum/posts?status=1` | ✅ Admin |
| 3.3 | 获取帖子详情 | GET | `/api/forum/posts/{postId}` | ❌ |
| 3.4 | 点赞帖子 | POST | `/api/forum/posts/{postId}/like` | ✅ User |
| 3.5 | 评论帖子 | POST | `/api/forum/posts/{postId}/comments` | ✅ User |
| 3.6a | 用户删帖 | PUT | `/api/forum/posts/{postId}/status` | ✅ User |
| 3.6b | 管理员隐藏 | PUT | `/api/forum/posts/{postId}/status` | ✅ Admin |
| 3.6c | 管理员公开 | PUT | `/api/forum/posts/{postId}/status` | ✅ Admin |
| 3.6d | 权限测试 | PUT | `/api/forum/posts/{postId}/status` | ✅ User |
| 3.7 | 用户主页 | GET | `/api/forum/user/{userId}/posts` | ❌ |

---

## 🔑 获取 Token

### 普通用户 Token
```bash
POST http://localhost:8080/api/auth/login
Content-Type: application/json

{
  "phone": "13800138000",
  "password": "user123"
}

# 复制响应中的 data.token
```

### 管理员 Token
```bash
POST http://localhost:8080/api/auth/login
Content-Type: application/json

{
  "phone": "admin",
  "password": "admin123"
}

# 复制响应中的 data.token
```

---

## 📊 状态码说明

| 状态码 | 名称 | 可见性 |
|-------|------|--------|
| 0 | 公开 | 所有人可见 |
| 1 | 待审核 | 仅管理员 |
| 2 | 私密 | 仅管理员 |
| 3 | 已删除 | 所有人不可见 |

---

## 🎯 3.6 接口操作类型

| action | 角色 | 结果状态 | 说明 |
|--------|------|---------|------|
| delete | User | 3 | 用户删除自己的帖子 |
| privatize | Admin | 2 | 管理员隐藏帖子 |
| publicize | Admin | 0 | 管理员公开帖子 |

### 请求体示例
```json
// 用户删帖
{
  "action": "delete",
  "reason": "不想公开了"
}

// 管理员隐藏
{
  "action": "privatize",
  "reason": "内容违规"
}

// 管理员公开
{
  "action": "publicize",
  "reason": "审核通过"
}
```

---

## ✅ 测试检查清单

**基础功能**
- [ ] 发布帖子（带图片）
- [ ] 获取帖子列表（分页）
- [ ] 获取单个帖子详情
- [ ] 点赞与取消点赞
- [ ] 发表评论

**状态管理**
- [ ] 用户删除自己的帖子（status → 3）
- [ ] 管理员隐藏帖子（status → 2）
- [ ] 管理员公开帖子（status → 0）

**权限控制**
- [ ] 用户不能删除他人帖子 ❌
- [ ] 用户不能执行 privatize ❌
- [ ] 用户不能执行 publicize ❌

**筛选与查询**
- [ ] 按状态筛选（status=0,1,2,3）
- [ ] 分页查询（page & size）
- [ ] 获取用户主页

---

## 🐛 常见错误

| 错误码 | 原因 | 解决方法 |
|-------|------|---------|
| 401 | Token无效/过期 | 重新登录获取新token |
| 403 | 权限不足 | 检查是否使用了管理员token |
| 400 | 参数错误 | 检查请求体格式和必填字段 |
| 404 | 帖子不存在 | 检查postId是否正确 |

---

## 💡 测试技巧

1. **使用 Collection Runner**
   - 点击 Collection → Run
   - 批量执行所有测试
   - 查看通过率报告

2. **自动验证响应**
   - 每个请求都配置了 Tests 脚本
   - 自动检查状态码和响应结构
   - 自动保存 postId 变量

3. **环境切换**
   - 开发环境：`http://localhost:8080`
   - 测试环境：修改 baseUrl
   - 生产环境：修改 baseUrl

---

## 📞 需要帮助？

详细文档：`模块三-Postman测试指南.md`

**后端负责人**：hly
**模块**：模块三 - 论坛模块

---

**最后更新**：2025-11-25

